function [act_cases,act_delta] = DrugSimulation(inputlvls,inputnodes,perturblvls,perturbnodes,tension) 
% Generated by Netflux 0.08a on 14-Apr-2020
% Edited 05-18-2020 JR
% Changes: added study-specific stimuli, new args for node perturbs,
% re-organized outputs into single matrix (cases x outputs)
% 
% New args: 'perturblvls': numeric matrix of size (cases x nodes),
% specifying magnitude and direction of perturbation. Signs of doubles 
% designate direction: positive = overexpression, negative = knockdown.
% 'perturbnodes': integer vector of size (nodes), specifying nodes to be
% perturbed. Order should correspond to columns of 'perturblvls'.

% set default tension argument
if nargin<3
    tension = 0.1;
end

%%%%%% parameters from Netflux script %%%%%%
% species parameters
speciesNames = {'AngII','AT1R','AGT','ACE','NOX','ROS','ET1','ETAR','DAG','PKC','TRPC','NE','BAR','AC','cAMP','PKA','CREB','CBP','TGFB','TGFB1R','smad3','smad7','latentTGFB','BAMBI','PDGF','PDGFR','NP','NPRA','cGMP','PKG','tension','B1int','Rho','ROCK','Ca','calcineurin','NFAT','IL6','gp130','STAT','IL1','IL1RI','TNFa','TNFaR','NFKB','PI3K','Akt','p38','TRAF','ASK1','MKK3','PP1','JNK','abl','Rac1','MEKK1','MKK4','ERK','Ras','Raf','MEK1','FAK','epac','Factin','FA','cmyc','CTGF','proliferation','SRF','EDAFN','aSMA','AP1','TIMP1','TIMP2','PAI1','proMMP14','proMMP1','proMMP2','proMMP9','fibronectin','periostin','proCI','proCIII','B3int','Src','Grb2','p130Cas','YAP','MRTF','Gactin','TNC','mTORC1','mTORC2','p70S6K','EBP1','syndecan4','proMMP3','proMMP8','proMMP12','thrombospondin4','osteopontin','contractility','RhoGEF','RhoGDI','talin','vinculin','paxillin','MLC','AT2R',}; 
tau = [1, 1.000000e-01, 10, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1, 1.000000e-01, 1.000000e-01, 10, 10, 1.000000e-01, 1, 1.000000e-01, 1, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1, 1.000000e-01, 1.000000e-01, 1, 1.000000e-01, 1, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1, 1, 1.000000e-01, 1.000000e-01, 10, 1.000000e-01, 10, 10, 1.000000e-01, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1, 10, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 10, 10, 10, 10, 10, 10, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, ]; 
ymax = [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, ];
 
% reaction parameters
w = [1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 1.000000e-01, 8.000000e-01, 8.000000e-01, 8.000000e-01, 8.000000e-01, 8.000000e-01, 8.000000e-01, 8.000000e-01, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 8.000000e-01, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 8.000000e-01, 1, 1, 1, 8.000000e-01, 1, 1, 1, 1, 1, 1, 1, 1, 8.000000e-01, 1, 1, 1, 1, 1, 1, 1, ]; 
n = [1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, 1.250000e+00, ]; 
EC50 = [6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, 6.000000e-01, ]; 
rpar = [w;n;EC50];                          % packages parameters

y0 = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ]; 

% run basal (negative control) simulation
fprintf("Running basal simulation...\n")
ymax_test = ymax;                           % reset ymax vals
params = {rpar,tau,ymax_test,speciesNames};
tspan = [0 80];                             % set time step
options = [];
[~,y1] = ode23(@ODEfun,tspan,y0,options,params);
act_cases = real(y1(end,:));

% run positive control simulation
fprintf("Running positive control simulation...\n")
for i = 1:length(inputnodes)
    w(inputnodes(i)) = inputlvls(i);        % sets input levels from arguments
end
w(3) = tension;                             % sets tension level from arguments
rpar = [w;n;EC50];                          % integrate new parameters
params = {rpar,tau,ymax_test,speciesNames};
tspan = [80 320];
[~,y2] = ode23(@ODEfun,tspan,real(y1(end,:)),options,params);
act_cases(2,:) = real(y2(end,:));

% run simulations with specified perturbations
if isempty(perturblvls) == 0
    for i = 1:size(perturblvls,1)
        fprintf("Running perturbation simulation: %i/%i...\n",i,size(perturblvls,1))
        ymax_test = ymax;                           % reset ymax vals
        for j = 1:size(perturblvls,2)
            ymax_test(perturbnodes(j)) = 1+perturblvls(i,j);
        end
        params = {rpar,tau,ymax_test,speciesNames}; % integrate new ymax into params
        [~,y2] = ode23(@ODEfun,tspan,real(y1(end,:)),options,params);
        act_cases(i+2,:) = real(y2(end,:));
    end
end

% calculate delta(Activity): abs(act_ko - act_b)
act_delta = act_cases(2:end,:) - act_cases(1,:);

% save results
% filedir = "D:\Research\Aim2\ModelExpansion\1_1\rev4\DrugValidation\";
% filename = 'drugvalidation_';
% tensionname = replace(string(tension),".","");
% save(strcat(filedir,filename,"_tension",tensionname,'_fback075.mat'),'act_delta','act_b','act_ko');
% save(strcat(filedir,filename,'speciesNames.mat'),'speciesNames');
 
function dydt=ODEfun(t,y,params) 
% Assign names for parameters 
[rpar,tau,ymax,speciesNames]=params{:}; 
AngII = 1; 
AT1R = 2; 
AGT = 3; 
ACE = 4; 
NOX = 5; 
ROS = 6; 
ET1 = 7; 
ETAR = 8; 
DAG = 9; 
PKC = 10; 
TRPC = 11; 
NE = 12; 
BAR = 13; 
AC = 14; 
cAMP = 15; 
PKA = 16; 
CREB = 17; 
CBP = 18; 
TGFB = 19; 
TGFB1R = 20; 
smad3 = 21; 
smad7 = 22; 
latentTGFB = 23; 
BAMBI = 24; 
PDGF = 25; 
PDGFR = 26; 
NP = 27; 
NPRA = 28; 
cGMP = 29; 
PKG = 30; 
tension = 31; 
B1int = 32; 
Rho = 33; 
ROCK = 34; 
Ca = 35; 
calcineurin = 36; 
NFAT = 37; 
IL6 = 38; 
gp130 = 39; 
STAT = 40; 
IL1 = 41; 
IL1RI = 42; 
TNFa = 43; 
TNFaR = 44; 
NFKB = 45; 
PI3K = 46; 
Akt = 47; 
p38 = 48; 
TRAF = 49; 
ASK1 = 50; 
MKK3 = 51; 
PP1 = 52; 
JNK = 53; 
abl = 54; 
Rac1 = 55; 
MEKK1 = 56; 
MKK4 = 57; 
ERK = 58; 
Ras = 59; 
Raf = 60; 
MEK1 = 61; 
FAK = 62; 
epac = 63; 
Factin = 64; 
FA = 65; 
cmyc = 66; 
CTGF = 67; 
proliferation = 68; 
SRF = 69; 
EDAFN = 70; 
aSMA = 71; 
AP1 = 72; 
TIMP1 = 73; 
TIMP2 = 74; 
PAI1 = 75; 
proMMP14 = 76; 
proMMP1 = 77; 
proMMP2 = 78; 
proMMP9 = 79; 
fibronectin = 80; 
periostin = 81; 
proCI = 82; 
proCIII = 83; 
B3int = 84; 
Src = 85; 
Grb2 = 86; 
p130Cas = 87; 
YAP = 88; 
MRTF = 89; 
Gactin = 90; 
TNC = 91; 
mTORC1 = 92; 
mTORC2 = 93; 
p70S6K = 94; 
EBP1 = 95; 
syndecan4 = 96; 
proMMP3 = 97; 
proMMP8 = 98; 
proMMP12 = 99; 
thrombospondin4 = 100; 
osteopontin = 101; 
contractility = 102; 
RhoGEF = 103; 
RhoGDI = 104; 
talin = 105; 
vinculin = 106; 
paxillin = 107; 
MLC = 108; 
AT2R = 109; 
dydt = zeros(109,1); 
dydt(AngII) = (OR(rpar(1,1),AND(rpar(:,13),act(y(AGT),rpar(:,13)),act(y(ACE),rpar(:,13))))*ymax(AngII) - y(AngII))/tau(AngII); 
dydt(AT1R) = (OR(act(y(AngII),rpar(:,18)),act(y(tension),rpar(:,168)))*ymax(AT1R) - y(AT1R))/tau(AT1R); 
dydt(AGT) = (AND(rpar(:,27),inhib(y(AT1R),rpar(:,27)),act(y(p38),rpar(:,27)),inhib(y(JNK),rpar(:,27)))*ymax(AGT) - y(AGT))/tau(AGT); 
dydt(ACE) = (act(y(TGFB1R),rpar(:,50))*ymax(ACE) - y(ACE))/tau(ACE); 
dydt(NOX) = (OR(act(y(AT1R),rpar(:,19)),act(y(TGFB1R),rpar(:,99)))*ymax(NOX) - y(NOX))/tau(NOX); 
dydt(ROS) = (OR(act(y(NOX),rpar(:,20)),act(y(ETAR),rpar(:,37)))*ymax(ROS) - y(ROS))/tau(ROS); 
dydt(ET1) = (OR(rpar(1,9),act(y(AP1),rpar(:,17)))*ymax(ET1) - y(ET1))/tau(ET1); 
dydt(ETAR) = (act(y(ET1),rpar(:,56))*ymax(ETAR) - y(ETAR))/tau(ETAR); 
dydt(DAG) = (OR(act(y(ETAR),rpar(:,113)),act(y(AT1R),rpar(:,114)))*ymax(DAG) - y(DAG))/tau(DAG); 
dydt(PKC) = (OR(act(y(syndecan4),rpar(:,133)),AND(rpar(:,149),act(y(DAG),rpar(:,149)),act(y(mTORC2),rpar(:,149))))*ymax(PKC) - y(PKC))/tau(PKC); 
dydt(TRPC) = (OR(act(y(DAG),rpar(:,115)),act(y(tension),rpar(:,167)))*ymax(TRPC) - y(TRPC))/tau(TRPC); 
dydt(NE) = (rpar(1,7)*ymax(NE) - y(NE))/tau(NE); 
dydt(BAR) = (act(y(NE),rpar(:,55))*ymax(BAR) - y(BAR))/tau(BAR); 
dydt(AC) = (OR(act(y(BAR),rpar(:,64)),AND(rpar(:,65),act(y(AT1R),rpar(:,65)),act(y(BAR),rpar(:,65))))*ymax(AC) - y(AC))/tau(AC); 
dydt(cAMP) = (act(y(AC),rpar(:,66))*ymax(cAMP) - y(cAMP))/tau(cAMP); 
dydt(PKA) = (act(y(cAMP),rpar(:,44))*ymax(PKA) - y(PKA))/tau(PKA); 
dydt(CREB) = (act(y(PKA),rpar(:,53))*ymax(CREB) - y(CREB))/tau(CREB); 
dydt(CBP) = (OR(inhib(y(smad3),rpar(:,46)),inhib(y(CREB),rpar(:,47)))*ymax(CBP) - y(CBP))/tau(CBP); 
dydt(TGFB) = (OR(rpar(1,2),OR(AND(rpar(:,11),act(y(latentTGFB),rpar(:,11)),act(y(proMMP9),rpar(:,11))),AND(rpar(:,12),act(y(latentTGFB),rpar(:,12)),act(y(proMMP2),rpar(:,12)))))*ymax(TGFB) - y(TGFB))/tau(TGFB); 
dydt(TGFB1R) = (AND(rpar(:,51),act(y(TGFB),rpar(:,51)),inhib(y(BAMBI),rpar(:,51)))*ymax(TGFB1R) - y(TGFB1R))/tau(TGFB1R); 
dydt(smad3) = (OR(AND(rpar(:,28),act(y(TGFB1R),rpar(:,28)),inhib(y(smad7),rpar(:,28)),inhib(y(PKG),rpar(:,28))),act(y(Akt),rpar(:,144)))*ymax(smad3) - y(smad3))/tau(smad3); 
dydt(smad7) = (OR(act(y(STAT),rpar(:,104)),AND(rpar(:,158),act(y(AP1),rpar(:,158)),inhib(y(YAP),rpar(:,158))))*ymax(smad7) - y(smad7))/tau(smad7); 
dydt(latentTGFB) = (act(y(AP1),rpar(:,68))*ymax(latentTGFB) - y(latentTGFB))/tau(latentTGFB); 
dydt(BAMBI) = (AND(rpar(:,103),act(y(TGFB),rpar(:,103)),act(y(IL1RI),rpar(:,103)))*ymax(BAMBI) - y(BAMBI))/tau(BAMBI); 
dydt(PDGF) = (rpar(1,8)*ymax(PDGF) - y(PDGF))/tau(PDGF); 
dydt(PDGFR) = (act(y(PDGF),rpar(:,63))*ymax(PDGFR) - y(PDGFR))/tau(PDGFR); 
dydt(NP) = (rpar(1,10)*ymax(NP) - y(NP))/tau(NP); 
dydt(NPRA) = (act(y(NP),rpar(:,72))*ymax(NPRA) - y(NPRA))/tau(NPRA); 
dydt(cGMP) = (act(y(NPRA),rpar(:,73))*ymax(cGMP) - y(cGMP))/tau(cGMP); 
dydt(PKG) = (act(y(cGMP),rpar(:,74))*ymax(PKG) - y(PKG))/tau(PKG); 
dydt(tension) = (OR(rpar(1,3),AND(rpar(:,165),act(y(FA),rpar(:,165)),act(y(contractility),rpar(:,165))))*ymax(tension) - y(tension))/tau(tension); 
dydt(B1int) = (OR(AND(rpar(:,43),act(y(PKC),rpar(:,43)),act(y(tension),rpar(:,43))),act(y(tension),rpar(:,48)))*ymax(B1int) - y(B1int))/tau(B1int); 
dydt(Rho) = (OR(act(y(TGFB1R),rpar(:,118)),AND(rpar(:,131),inhib(y(PKG),rpar(:,131)),act(y(RhoGEF),rpar(:,131)),inhib(y(RhoGDI),rpar(:,131))))*ymax(Rho) - y(Rho))/tau(Rho); 
dydt(ROCK) = (act(y(Rho),rpar(:,70))*ymax(ROCK) - y(ROCK))/tau(ROCK); 
dydt(Ca) = (act(y(TRPC),rpar(:,116))*ymax(Ca) - y(Ca))/tau(Ca); 
dydt(calcineurin) = (act(y(Ca),rpar(:,117))*ymax(calcineurin) - y(calcineurin))/tau(calcineurin); 
dydt(NFAT) = (act(y(calcineurin),rpar(:,109))*ymax(NFAT) - y(NFAT))/tau(NFAT); 
dydt(IL6) = (OR(rpar(1,4),OR(AND(rpar(:,14),act(y(CREB),rpar(:,14)),act(y(CBP),rpar(:,14))),OR(act(y(NFKB),rpar(:,15)),act(y(AP1),rpar(:,16)))))*ymax(IL6) - y(IL6))/tau(IL6); 
dydt(gp130) = (act(y(IL6),rpar(:,21))*ymax(gp130) - y(gp130))/tau(gp130); 
dydt(STAT) = (act(y(gp130),rpar(:,25))*ymax(STAT) - y(STAT))/tau(STAT); 
dydt(IL1) = (rpar(1,5)*ymax(IL1) - y(IL1))/tau(IL1); 
dydt(IL1RI) = (act(y(IL1),rpar(:,58))*ymax(IL1RI) - y(IL1RI))/tau(IL1RI); 
dydt(TNFa) = (rpar(1,6)*ymax(TNFa) - y(TNFa))/tau(TNFa); 
dydt(TNFaR) = (act(y(TNFa),rpar(:,71))*ymax(TNFaR) - y(TNFaR))/tau(TNFaR); 
dydt(NFKB) = (OR(act(y(IL1RI),rpar(:,24)),OR(act(y(ERK),rpar(:,34)),OR(act(y(p38),rpar(:,35)),act(y(Akt),rpar(:,100)))))*ymax(NFKB) - y(NFKB))/tau(NFKB); 
dydt(PI3K) = (OR(act(y(TNFaR),rpar(:,26)),OR(act(y(TGFB1R),rpar(:,96)),OR(act(y(PDGFR),rpar(:,97)),act(y(FAK),rpar(:,98)))))*ymax(PI3K) - y(PI3K))/tau(PI3K); 
dydt(Akt) = (AND(rpar(:,148),act(y(PI3K),rpar(:,148)),act(y(mTORC2),rpar(:,148)))*ymax(Akt) - y(Akt))/tau(Akt); 
dydt(p38) = (OR(act(y(ROS),rpar(:,22)),OR(act(y(MKK3),rpar(:,79)),OR(act(y(Ras),rpar(:,95)),AND(rpar(:,106),act(y(Rho),rpar(:,106)),inhib(y(Rac1),rpar(:,106))))))*ymax(p38) - y(p38))/tau(p38); 
dydt(TRAF) = (OR(act(y(TGFB1R),rpar(:,80)),act(y(TNFaR),rpar(:,88)))*ymax(TRAF) - y(TRAF))/tau(TRAF); 
dydt(ASK1) = (OR(act(y(TRAF),rpar(:,89)),act(y(IL1RI),rpar(:,92)))*ymax(ASK1) - y(ASK1))/tau(ASK1); 
dydt(MKK3) = (act(y(ASK1),rpar(:,90))*ymax(MKK3) - y(MKK3))/tau(MKK3); 
dydt(PP1) = (act(y(p38),rpar(:,78))*ymax(PP1) - y(PP1))/tau(PP1); 
dydt(JNK) = (OR(act(y(ROS),rpar(:,23)),OR(AND(rpar(:,83),inhib(y(NFKB),rpar(:,83)),act(y(MKK4),rpar(:,83))),AND(rpar(:,107),inhib(y(Rho),rpar(:,107)),act(y(MKK4),rpar(:,107)))))*ymax(JNK) - y(JNK))/tau(JNK); 
dydt(abl) = (act(y(PDGFR),rpar(:,84))*ymax(abl) - y(abl))/tau(abl); 
dydt(Rac1) = (OR(act(y(abl),rpar(:,85)),AND(rpar(:,128),act(y(abl),rpar(:,128)),act(y(p130Cas),rpar(:,128))))*ymax(Rac1) - y(Rac1))/tau(Rac1); 
dydt(MEKK1) = (OR(act(y(FAK),rpar(:,67)),act(y(Rac1),rpar(:,81)))*ymax(MEKK1) - y(MEKK1))/tau(MEKK1); 
dydt(MKK4) = (OR(act(y(MEKK1),rpar(:,82)),act(y(ASK1),rpar(:,91)))*ymax(MKK4) - y(MKK4))/tau(MKK4); 
dydt(ERK) = (OR(AND(rpar(:,77),inhib(y(PP1),rpar(:,77)),act(y(MEK1),rpar(:,77))),AND(rpar(:,172),act(y(ROS),rpar(:,172)),inhib(y(AT2R),rpar(:,172))))*ymax(ERK) - y(ERK))/tau(ERK); 
dydt(Ras) = (OR(act(y(AT1R),rpar(:,110)),act(y(Grb2),rpar(:,122)))*ymax(Ras) - y(Ras))/tau(Ras); 
dydt(Raf) = (act(y(Ras),rpar(:,75))*ymax(Raf) - y(Raf))/tau(Raf); 
dydt(MEK1) = (AND(rpar(:,76),inhib(y(ERK),rpar(:,76)),act(y(Raf),rpar(:,76)))*ymax(MEK1) - y(MEK1))/tau(MEK1); 
dydt(FAK) = (act(y(B1int),rpar(:,120))*ymax(FAK) - y(FAK))/tau(FAK); 
dydt(epac) = (act(y(cAMP),rpar(:,69))*ymax(epac) - y(epac))/tau(epac); 
dydt(Factin) = (AND(rpar(:,136),act(y(ROCK),rpar(:,136)),act(y(Gactin),rpar(:,136)))*ymax(Factin) - y(Factin))/tau(Factin); 
dydt(FA) = (AND(rpar(:,160),act(y(vinculin),rpar(:,160)),inhib(y(paxillin),rpar(:,160)))*ymax(FA) - y(FA))/tau(FA); 
dydt(cmyc) = (act(y(JNK),rpar(:,86))*ymax(cmyc) - y(cmyc))/tau(cmyc); 
dydt(CTGF) = (OR(AND(rpar(:,29),act(y(CBP),rpar(:,29)),act(y(smad3),rpar(:,29)),act(y(ERK),rpar(:,29))),act(y(YAP),rpar(:,132)))*ymax(CTGF) - y(CTGF))/tau(CTGF); 
dydt(proliferation) = (OR(act(y(AP1),rpar(:,52)),OR(act(y(CREB),rpar(:,54)),OR(act(y(CTGF),rpar(:,57)),OR(act(y(PKC),rpar(:,59)),OR(act(y(cmyc),rpar(:,87)),AND(rpar(:,143),act(y(p70S6K),rpar(:,143)),inhib(y(EBP1),rpar(:,143))))))))*ymax(proliferation) - y(proliferation))/tau(proliferation); 
dydt(SRF) = (act(y(MRTF),rpar(:,138))*ymax(SRF) - y(SRF))/tau(SRF); 
dydt(EDAFN) = (act(y(NFAT),rpar(:,49))*ymax(EDAFN) - y(EDAFN))/tau(EDAFN); 
dydt(aSMA) = (OR(AND(rpar(:,111),act(y(CBP),rpar(:,111)),act(y(smad3),rpar(:,111))),OR(act(y(SRF),rpar(:,112)),act(y(YAP),rpar(:,170))))*ymax(aSMA) - y(aSMA))/tau(aSMA); 
dydt(AP1) = (OR(act(y(ERK),rpar(:,38)),act(y(JNK),rpar(:,102)))*ymax(AP1) - y(AP1))/tau(AP1); 
dydt(TIMP1) = (act(y(AP1),rpar(:,41))*ymax(TIMP1) - y(TIMP1))/tau(TIMP1); 
dydt(TIMP2) = (act(y(AP1),rpar(:,42))*ymax(TIMP2) - y(TIMP2))/tau(TIMP2); 
dydt(PAI1) = (OR(act(y(smad3),rpar(:,93)),act(y(YAP),rpar(:,150)))*ymax(PAI1) - y(PAI1))/tau(PAI1); 
dydt(proMMP14) = (OR(act(y(AP1),rpar(:,62)),act(y(NFKB),rpar(:,94)))*ymax(proMMP14) - y(proMMP14))/tau(proMMP14); 
dydt(proMMP1) = (AND(rpar(:,36),inhib(y(smad3),rpar(:,36)),act(y(NFKB),rpar(:,36)),act(y(AP1),rpar(:,36)))*ymax(proMMP1) - y(proMMP1))/tau(proMMP1); 
dydt(proMMP2) = (OR(act(y(STAT),rpar(:,30)),act(y(AP1),rpar(:,39)))*ymax(proMMP2) - y(proMMP2))/tau(proMMP2); 
dydt(proMMP9) = (OR(act(y(STAT),rpar(:,31)),AND(rpar(:,40),act(y(NFKB),rpar(:,40)),act(y(AP1),rpar(:,40))))*ymax(proMMP9) - y(proMMP9))/tau(proMMP9); 
dydt(fibronectin) = (OR(AND(rpar(:,45),act(y(CBP),rpar(:,45)),act(y(smad3),rpar(:,45))),act(y(NFKB),rpar(:,101)))*ymax(fibronectin) - y(fibronectin))/tau(fibronectin); 
dydt(periostin) = (OR(AND(rpar(:,32),act(y(CBP),rpar(:,32)),act(y(smad3),rpar(:,32))),AND(rpar(:,33),act(y(CREB),rpar(:,33)),act(y(CBP),rpar(:,33))))*ymax(periostin) - y(periostin))/tau(periostin); 
dydt(proCI) = (OR(AND(rpar(:,60),act(y(CBP),rpar(:,60)),act(y(smad3),rpar(:,60)),inhib(y(epac),rpar(:,60))),act(y(SRF),rpar(:,105)))*ymax(proCI) - y(proCI))/tau(proCI); 
dydt(proCIII) = (OR(AND(rpar(:,61),act(y(CBP),rpar(:,61)),act(y(smad3),rpar(:,61)),inhib(y(epac),rpar(:,61))),act(y(SRF),rpar(:,108)))*ymax(proCIII) - y(proCIII))/tau(proCIII); 
dydt(B3int) = (OR(AND(rpar(:,152),act(y(tension),rpar(:,152)),inhib(y(thrombospondin4),rpar(:,152))),act(y(osteopontin),rpar(:,156)))*ymax(B3int) - y(B3int))/tau(B3int); 
dydt(Src) = (OR(act(y(B3int),rpar(:,119)),act(y(PDGFR),rpar(:,126)))*ymax(Src) - y(Src))/tau(Src); 
dydt(Grb2) = (AND(rpar(:,121),act(y(FAK),rpar(:,121)),act(y(Src),rpar(:,121)))*ymax(Grb2) - y(Grb2))/tau(Grb2); 
dydt(p130Cas) = (OR(AND(rpar(:,125),act(y(FAK),rpar(:,125)),act(y(Src),rpar(:,125))),AND(rpar(:,127),act(y(tension),rpar(:,127)),act(y(Src),rpar(:,127))))*ymax(p130Cas) - y(p130Cas))/tau(p130Cas); 
dydt(YAP) = (OR(act(y(Factin),rpar(:,129)),act(y(AT1R),rpar(:,169)))*ymax(YAP) - y(YAP))/tau(YAP); 
dydt(MRTF) = (AND(rpar(:,135),act(y(NFAT),rpar(:,135)),inhib(y(Gactin),rpar(:,135)))*ymax(MRTF) - y(MRTF))/tau(MRTF); 
dydt(Gactin) = (inhib(y(Factin),rpar(:,137))*ymax(Gactin) - y(Gactin))/tau(Gactin); 
dydt(TNC) = (OR(act(y(NFKB),rpar(:,145)),act(y(MRTF),rpar(:,146)))*ymax(TNC) - y(TNC))/tau(TNC); 
dydt(mTORC1) = (act(y(Akt),rpar(:,140))*ymax(mTORC1) - y(mTORC1))/tau(mTORC1); 
dydt(mTORC2) = (inhib(y(p70S6K),rpar(:,147))*ymax(mTORC2) - y(mTORC2))/tau(mTORC2); 
dydt(p70S6K) = (act(y(mTORC1),rpar(:,141))*ymax(p70S6K) - y(p70S6K))/tau(p70S6K); 
dydt(EBP1) = (inhib(y(mTORC1),rpar(:,142))*ymax(EBP1) - y(EBP1))/tau(EBP1); 
dydt(syndecan4) = (AND(rpar(:,139),act(y(tension),rpar(:,139)),inhib(y(TNC),rpar(:,139)))*ymax(syndecan4) - y(syndecan4))/tau(syndecan4); 
dydt(proMMP3) = (AND(rpar(:,154),inhib(y(smad3),rpar(:,154)),act(y(NFKB),rpar(:,154)),act(y(AP1),rpar(:,154)))*ymax(proMMP3) - y(proMMP3))/tau(proMMP3); 
dydt(proMMP8) = (AND(rpar(:,153),inhib(y(smad3),rpar(:,153)),act(y(NFKB),rpar(:,153)),act(y(AP1),rpar(:,153)))*ymax(proMMP8) - y(proMMP8))/tau(proMMP8); 
dydt(proMMP12) = (act(y(CREB),rpar(:,157))*ymax(proMMP12) - y(proMMP12))/tau(proMMP12); 
dydt(thrombospondin4) = (act(y(smad3),rpar(:,151))*ymax(thrombospondin4) - y(thrombospondin4))/tau(thrombospondin4); 
dydt(osteopontin) = (act(y(AP1),rpar(:,155))*ymax(osteopontin) - y(osteopontin))/tau(osteopontin); 
dydt(contractility) = (AND(rpar(:,164),act(y(Factin),rpar(:,164)),act(y(vinculin),rpar(:,164)),act(y(MLC),rpar(:,164)))*ymax(contractility) - y(contractility))/tau(contractility); 
dydt(RhoGEF) = (AND(rpar(:,123),act(y(FAK),rpar(:,123)),act(y(Src),rpar(:,123)))*ymax(RhoGEF) - y(RhoGEF))/tau(RhoGEF); 
dydt(RhoGDI) = (OR(inhib(y(Src),rpar(:,124)),OR(act(y(PKA),rpar(:,130)),inhib(y(PKC),rpar(:,134))))*ymax(RhoGDI) - y(RhoGDI))/tau(RhoGDI); 
dydt(talin) = (OR(act(y(B1int),rpar(:,161)),act(y(B3int),rpar(:,162)))*ymax(talin) - y(talin))/tau(talin); 
dydt(vinculin) = (AND(rpar(:,163),act(y(tension),rpar(:,163)),act(y(talin),rpar(:,163)))*ymax(vinculin) - y(vinculin))/tau(vinculin); 
dydt(paxillin) = (AND(rpar(:,159),act(y(FAK),rpar(:,159)),act(y(Src),rpar(:,159)),act(y(MLC),rpar(:,159)))*ymax(paxillin) - y(paxillin))/tau(paxillin); 
dydt(MLC) = (act(y(ROCK),rpar(:,166))*ymax(MLC) - y(MLC))/tau(MLC); 
dydt(AT2R) = (act(y(AngII),rpar(:,171))*ymax(AT2R) - y(AT2R))/tau(AT2R); 

% utility functions 
function fact = act(x,rpar) 
% hill activation function with parameters w (weight), n (Hill coeff), EC50 
    w = rpar(1); 
    n = rpar(2); 
    EC50 = rpar(3); 
    beta = (EC50.^n - 1)./(2*EC50.^n - 1); 
    K = (beta - 1).^(1./n); 
    fact = w.*(beta.*x.^n)./(K.^n + x.^n); 
    if fact>w,                 % cap fact(x)<= 1 
        fact = w; 
    end
 
function finhib = inhib(x,rpar) 
% inverse hill function with parameters w (weight), n (Hill coeff), EC50 
    finhib = rpar(1) - act(x,rpar);
 
function z = OR(x,y) 
% OR logic gate 
    z = x + y - x*y;
 
function z = AND(rpar,varargin) 
% AND logic gate, multiplying all of the reactants together 
    w = rpar(1); 
    if w == 0, 
        z = 0; 
    else 
        v = cell2mat(varargin); 
        z = prod(v)/w^(nargin-2);  
    end 
